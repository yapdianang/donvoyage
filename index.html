<html>
  <head>
    <style>
    * { margin: 0; padding: 0; }
    </style>
  </head>
  <body style="background-color: #0052A5;">

    <div id="geochart-colors" style="width: 800px; height: 600px; position: absolute; left: 50%; top: 50px; margin-left: -400px;"></div>

    <img src="plane.png" width="100" style="position: absolute; left: 50%; top: 25px; margin-left: -250px;"/>
    <div style="color: white; text-transform: uppercase; width: 600px; position: absolute; left: 50%; top: 25px; margin-left: -300px; text-align: center; font-family: 'Montserrat'; font-size: 40px;">Don' Voyage</div>
    
    <!-- You <span style="font-weight: 600;">can</span> leave on a flight <span style="color: white; font-weight: 600;">tomorrow</span> to <span style="font-weight: 600; color: #DAA520;">Mexico</span> for <span style="font-weight: 600; color: white;">$480.32</span> US dollars! -->
    <div id="price" style="color: rgb(200, 200, 200); width: 100%; position: absolute; bottom: 0px; text-align: center; font-family: 'Helvetica Neue'; font-weight: 300; font-size: 20px; background-color: black; line-height: 50px;">Click on a country to try flying there.</div>
  
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      google.charts.load('upcoming', {'packages':['geochart']});
      google.charts.setOnLoadCallback(drawRegionsMap);

      function drawRegionsMap() {
        var data = google.visualization.arrayToDataTable([
          //['Country', 'Avoid'], ['United States', 100], ['Libya', 16], ['Sudan', 16], ['Syria', 16], ['Iraq', 16], ['Iran', 16], ['Yemen', 16], ['Somalia', 16]
          ['Country', 'Businesses'], ['United States', 100], ['India', 16], ['Indonesia', 16], ['Canada', 14], ['UAE', 12], ['United Kingdom', 10], ['China', 9], ['Brazil', 8], ['Panama', 8], ['Saudi Arabia', 8], ['French West Indies', 8], ['Azerbaijan', 6], ['St. Vincent and the Grenadines', 4], ['Ireland', 4], ['Israel', 4], ['Qatar', 4], ['Dominican Republic', 3], ['Egypt', 2], ['Georgia', 2], ['Mexico', 2], ['Philippines', 2], ['South Africa', 2], ['Turkey', 2], ['Uruguay', 2], ['Bermuda', 1], ['Argentina', 1]
        ]);

        var options = {
          colorAxis: {values: [0, 16, 100], colors: ['#F0D6DB', '#E0162B', 'rgb(0, 200, 0)'],},
          backgroundColor: '#0052A5',
          datalessRegionColor: 'white',
          defaultColor: '#f5f5f5',
          legend: 'false'
        };

        chart = new google.visualization.GeoChart(document.getElementById('geochart-colors'));
        chart.draw(data, options);

        google.visualization.events.addListener(chart, 'regionClick', selectHandler);
        
        function selectHandler(e) {
          var xhr = new XMLHttpRequest();
          xhr.open('get', 'https://restcountries.eu/rest/v1/name/' + e.region + '?fullText=true');
          xhr.onreadystatechange = function() {
            if(xhr.readyState == 4 && xhr.status == 200) {
              var capitalName = JSON.parse(xhr.responseText)[0]["capital"];
              var xhr2 = new XMLHttpRequest();
              xhr2.open('get', 'data.json');
              xhr2.onreadystatechange = function() {
                if(xhr2.readyState == 4 && xhr2.status == 200) {
                  var cities = JSON.parse(xhr2.responseText)['response'];
                  for(var i = 0; i < cities.length; i++) {
                    if(cities[i]['name'] == capitalName) {
                      var cityCode = cities[i]['code'];

                      var currentdate = new Date();
                      var month = (currentdate.getMonth() + 1);
                      if(month < 10) month = "0" + month;
                      var curDate = currentdate.getDate() + 1;
                      if(curDate < 10) curDate = "0" + curDate;

                      var datetime = currentdate.getFullYear() + "-" + month + "-" + curDate; 
                      var xhr3 = new XMLHttpRequest();
                      xhr3.open('get', 'https://api.sandbox.amadeus.com/v1.2/flights/extensive-search?apikey=uPGr2V8ikmN7xXWxu5bmNxTE4F9W4Fgn&origin=SFO&destination=' + cityCode + '&one-way=true&departure_date=' + datetime, true);
                      xhr3.onreadystatechange=function() {
                          if (xhr3.readyState==4 && xhr3.status==200) {
                            var price = JSON.parse(xhr3.responseText)['results'][0]['price'];
                            document.getElementById("price").innerHTML = "You <span style=\"font-weight: 600;\">can</span> leave on a flight <span style=\"color: white; font-weight: 600;\">tomorrow</span> to <span style=\"font-weight: 600; color: #DAA520;\">" + e.region + "</span> for <span style=\"font-weight: 600; color: white;\">$" + price + "</span> US dollars!";
                          } else if(xhr3.readyState == 4) {
                            document.getElementById("price").innerHTML = "No flights found, try another country :(";
                          }
                      }
                      xhr3.send();

                      break;
                    }
                  }
                }
              }
              xhr2.send();
            }
          }
          xhr.send();
        }


      }

    </script>

  </body>
</html>